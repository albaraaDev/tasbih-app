<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Tasbih Counter</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a1a2e" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: 'Cairo', Arial, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 10px;
        overflow: hidden;
        position: relative;
        direction: rtl;
      }

      .app-container {
        background: rgba(30, 30, 45, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        padding: 20px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        max-width: 380px;
        width: 100%;
        height: 100vh;
        max-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        height: 50px;
        flex-shrink: 0;
      }

      .app-title {
        color: #fff;
        font-size: 1.2rem;
        font-weight: 600;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
        border-radius: 15px;
        padding: 8px 16px;
        overflow: hidden;
        white-space: nowrap;
        position: relative;
        background: rgba(79, 172, 254, 0.1);
        border: 1px solid rgba(79, 172, 254, 0.2);
        flex-grow: 1;
        margin-left: 10px;
        text-align: center;
        direction: rtl;
      }

      .app-title:hover {
        background: rgba(79, 172, 254, 0.2);
        transform: translateY(-1px);
      }

      .title-text {
        display: inline-block;
        animation: scroll-text 10s linear infinite;
      }

      .title-text.paused {
        animation-play-state: paused;
      }

      .title-text.short {
        animation: none;
      }

      @keyframes scroll-text {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .control-buttons {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
        direction: ltr;
      }

      .control-btn {
        color: #fff;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-radius: 12px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        min-width: 40px;
        text-align: center;
      }

      .control-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }

      .counter-container {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        margin: 10px 0;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 25px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
      }

      .counter-container:hover {
        transform: translateY(-2px);
        box-shadow: 0 25px 50px rgba(102, 126, 234, 0.4);
      }

      .counter-container:active {
        transform: scale(0.98);
      }

      .counter-container.pulse {
        transform: scale(1.02);
        box-shadow: 0 30px 60px rgba(102, 126, 234, 0.5);
      }

      .counter-display {
        text-align: center;
        padding: 40px 20px;
        position: relative;
        z-index: 2;
        direction: rtl;
      }

      .counter-number {
        font-size: 4rem;
        font-weight: 700;
        color: #fff;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        margin-bottom: 10px;
      }

      .counter-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
        font-weight: 500;
      }

      .progress-section {
        margin: 15px 0;
        flex-shrink: 0;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        border-radius: 4px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        direction: rtl;
      }

      .goal-info {
        cursor: pointer;
        transition: all 0.3s ease;
        border-radius: 10px;
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.05);
      }

      .goal-info:hover {
        background: rgba(255, 255, 255, 0.15);
        color: white;
      }

      .auto-mode-info {
        font-size: 0.8rem;
        color: #4facfe;
        font-weight: 600;
      }

      .bottom-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-shrink: 0;
      }

      .bottom-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 15px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        direction: rtl;
      }

      .auto-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      }

      .auto-btn.active {
        background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
      }

      .groups-btn {
        background: linear-gradient(135deg, #ffd93d 0%, #ff9f43 100%);
        color: #333;
      }

      .bottom-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }

      /* Toast Notifications */
      .toast {
        position: fixed;
        top: 20px;
        right: -100%;
        background: rgba(30, 30, 45, 0.95);
        backdrop-filter: blur(20px);
        color: white;
        padding: 15px 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 5000;
        max-width: 90%;
        text-align: center;
        font-weight: 600;
        direction: rtl;
      }

      .toast.show {
        right: 20px;
      }

      .toast.hide {
        right: -100%;
      }

      .toast.success {
        border-color: #51cf66;
        background: rgba(81, 207, 102, 0.1);
      }

      .toast.celebration {
        border-color: #ffd93d;
        background: rgba(255, 217, 61, 0.1);
        animation: celebration 0.6s ease;
      }

      @keyframes celebration {
        0%,
        100% {
          right: 20px;
          transform: scale(1);
        }
        50% {
          right: 15px;
          transform: scale(1.05);
        }
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        z-index: 4000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background: rgba(30, 30, 45, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 25px;
        max-width: 350px;
        width: 90%;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transform: scale(0.8);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        direction: rtl;
        text-align: right;
      }

      .modal-overlay.show .modal {
        transform: scale(1);
      }

      .modal-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 15px;
        text-align: center;
        color: #4facfe;
        direction: rtl;
      }

      .modal-content {
        margin: 15px 0;
        line-height: 1.5;
        direction: rtl;
        text-align: right;
      }

      .modal-input {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
        margin: 10px 0;
        direction: rtl;
        text-align: right;
      }

      .modal-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .modal-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .modal-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .modal-btn.primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .modal-btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .modal-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .dhikr-list {
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
        direction: rtl;
      }

      .dhikr-item {
        padding: 12px;
        margin: 5px 0;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        direction: rtl;
        text-align: right;
      }

      .dhikr-item:hover {
        background: rgba(79, 172, 254, 0.2);
        border-color: #4facfe;
      }

      .group-item {
        padding: 15px;
        margin: 8px 0;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        direction: rtl;
        text-align: right;
      }

      .group-item:hover {
        background: rgba(255, 217, 61, 0.2);
        border-color: #ffd93d;
      }

      .group-title {
        font-weight: 600;
        margin-bottom: 5px;
        color: #ffd93d;
      }

      .group-desc {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .custom-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }

      .group-actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }

      .action-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 8px 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        min-width: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .edit-btn:hover {
        background: rgba(79, 172, 254, 0.3);
        border-color: #4facfe;
      }

      .delete-btn:hover {
        background: rgba(255, 107, 107, 0.3);
        border-color: #ff6b6b;
      }

      .floating-particles {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        overflow: hidden;
        border-radius: 30px;
      }

      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(79, 172, 254, 0.6);
        border-radius: 50%;
        animation: float 8s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      @media (max-width: 480px) {
        .app-container {
          padding: 15px;
        }

        .counter-number {
          font-size: 3.5rem;
        }

        .app-title {
          font-size: 1.1rem;
        }

        .counter-display {
          padding: 35px 15px;
        }
      }

      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        animation: ripple-effect 0.6s linear;
        pointer-events: none;
      }

      @keyframes ripple-effect {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <div class="floating-particles" id="particles"></div>

      <div class="header">
        <div class="app-title" id="appTitle">
          <span class="title-text" id="titleText">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</span>
        </div>
        <div class="control-buttons">
          <div class="control-btn" id="helpButton">?</div>
          <div class="control-btn" id="menuButton">â˜°</div>
        </div>
      </div>

      <div class="counter-container" id="counterContainer">
        <div class="counter-display">
          <div class="counter-number" id="counterNumber">0</div>
          <div class="counter-label">Ù…Ø±Ø©</div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-info">
          <div class="goal-info" id="goalInfo">Ø§Ù„Ù‡Ø¯Ù: 100</div>
          <div class="auto-mode-info" id="autoModeInfo"></div>
        </div>
      </div>

      <div class="bottom-controls">
        <button class="bottom-btn auto-btn" id="autoBtn">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
        <button class="bottom-btn groups-btn" id="groupsBtn">
          Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±
        </button>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal" id="modal">
        <div class="modal-title" id="modalTitle"></div>
        <div class="modal-content" id="modalContent"></div>
        <div class="modal-buttons" id="modalButtons"></div>
      </div>
    </div>

    <script>
      class AdvancedTasbihApp {
        constructor() {
          this.count = 0;
          this.goal = 100;
          this.currentDhikr = 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡';
          this.lastClickTime = 0;
          this.clickDebounceTime = 1000; // 1 second default, but can be set to 0
          this.titleScrollPaused = false;
          this.installPromptShown = false;

          // Auto mode properties
          this.autoMode = false;
          this.autoInterval = null;
          this.clickTimes = [];
          this.averageInterval = 0;
          this.autoModeAvailable = false;
          this.minClicksForAuto = 10;

          // Groups system
          this.currentGroup = null;
          this.currentGroupIndex = 0;
          this.inGroupMode = false;

          this.dhikrOptions = [
            'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡',
            'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡',
            'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±',
            'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡',
            'Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡',
            'Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡',
          ];

          this.dhikrGroups = [
            {
              name: 'Ø£Ø°ÙƒØ§Ø± Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©',
              dhikrs: [
                { text: 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡', count: 33 },
                { text: 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', count: 33 },
                { text: 'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±', count: 34 },
              ],
            },
            {
              name: 'Ø§Ù„Ø¨Ø§Ù‚ÙŠØ§Øª Ø§Ù„ØµØ§Ù„Ø­Ø§Øª',
              dhikrs: [
                { text: 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡', count: 25 },
                { text: 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', count: 25 },
                { text: 'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±', count: 25 },
                { text: 'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡', count: 25 },
              ],
            },
          ];

          this.customGroups = [];

          this.clickTimers = {
            title: null,
            counter: null,
            goal: null,
            autoReset: null,
          };

          this.initializeElements();
          this.attachEventListeners();
          this.createParticles();
          this.loadData();
          this.updateDisplay();
        }

        initializeElements() {
          this.appTitle = document.getElementById('appTitle');
          this.titleText = document.getElementById('titleText');
          this.counterNumber = document.getElementById('counterNumber');
          this.counterContainer = document.getElementById('counterContainer');
          this.progressFill = document.getElementById('progressFill');
          this.goalInfo = document.getElementById('goalInfo');
          this.autoBtn = document.getElementById('autoBtn');
          this.groupsBtn = document.getElementById('groupsBtn');
          this.autoModeInfo = document.getElementById('autoModeInfo');
          this.toast = document.getElementById('toast');
          this.modalOverlay = document.getElementById('modalOverlay');
          this.modal = document.getElementById('modal');
          this.modalTitle = document.getElementById('modalTitle');
          this.modalContent = document.getElementById('modalContent');
          this.modalButtons = document.getElementById('modalButtons');
        }

        attachEventListeners() {
          // Counter click
          this.counterContainer.addEventListener('click', (e) => {
            this.createRipple(e);
            this.incrementCount();
          });

          // Title click - pause/resume scroll OR double click to change dhikr
          this.appTitle.addEventListener('click', () => {
            this.handleDoubleClick(
              'title',
              () => this.showDhikrSelection(),
              () => this.toggleTitleScroll()
            );
          });

          // Double tap for counter reset
          this.counterNumber.addEventListener('click', (e) => {
            this.handleDoubleClick('counter', () => this.resetCount());
          });

          // Double tap for goal change
          this.goalInfo.addEventListener('click', () => {
            this.handleDoubleClick('goal', () => this.changeGoal());
          });

          // Auto mode button
          this.autoBtn.addEventListener('click', () => {
            this.toggleAutoMode();
          });

          // Groups button
          this.groupsBtn.addEventListener('click', () => {
            this.showGroupsModal();
          });

          // Help button
          document
            .getElementById('helpButton')
            .addEventListener('click', () => {
              this.showHelpModal();
            });

          // Menu button
          document
            .getElementById('menuButton')
            .addEventListener('click', () => {
              this.showMenuModal();
            });

          // Modal overlay click
          this.modalOverlay.addEventListener('click', (e) => {
            if (e.target === this.modalOverlay) {
              this.hideModal();
            }
          });

          // Double tap to reset auto interval
          this.autoModeInfo.addEventListener('click', () => {
            this.handleDoubleClick('autoReset', () => this.resetAutoInterval());
          });
        }

        createRipple(e) {
          const ripple = document.createElement('span');
          const rect = this.counterContainer.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          const x = e.clientX - rect.left - size / 2;
          const y = e.clientY - rect.top - size / 2;

          ripple.className = 'ripple';
          ripple.style.width = ripple.style.height = size + 'px';
          ripple.style.left = x + 'px';
          ripple.style.top = y + 'px';

          this.counterContainer.appendChild(ripple);

          setTimeout(() => {
            ripple.remove();
          }, 600);
        }

        toggleTitleScroll() {
          this.titleScrollPaused = !this.titleScrollPaused;
          if (this.titleScrollPaused) {
            this.titleText.classList.add('paused');
            this.showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ…Ø±ÙŠØ±', 'success');
          } else {
            this.titleText.classList.remove('paused');
            this.showToast('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ±', 'success');
          }
        }

        handleDoubleClick(
          type,
          doubleClickCallback,
          singleClickCallback = null
        ) {
          if (this.clickTimers[type]) {
            clearTimeout(this.clickTimers[type]);
            this.clickTimers[type] = null;
            doubleClickCallback();
          } else {
            this.clickTimers[type] = setTimeout(() => {
              this.clickTimers[type] = null;
              if (singleClickCallback) {
                singleClickCallback();
              }
            }, 300);
          }
        }

        incrementCount() {
          const now = Date.now();

          // Prevent rapid clicking (only if debounce time > 0)
          if (
            this.clickDebounceTime > 0 &&
            now - this.lastClickTime < this.clickDebounceTime
          ) {
            const waitTime = Math.ceil(
              (this.clickDebounceTime - (now - this.lastClickTime)) / 1000
            );
            this.showToast(
              `Ø§Ù†ØªØ¸Ø± ${waitTime} Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©`,
              'error'
            );
            return;
          }

          this.lastClickTime = now;
          this.count++;

          // Track click times for auto mode
          this.trackClickTime(now);

          this.updateDisplay();
          this.saveData();
          this.animateCounter();
          this.playFeedback();

          this.checkGoalReached();
          // Show install prompt after 3 counts
          if (this.count === 3 && !this.installPromptShown) {
            this.showInstallPrompt();
          }
        }

        showInstallPrompt() {
          if (this.neverShowInstallPrompt) return;

          this.installPromptShown = true;

          const content = `
            <div class="modal-content" style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“±</div>
              <h3 style="color: #4facfe; margin-bottom: 15px;">ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±Ùƒ!</h3>
              <p style="line-height: 1.6;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰:</p>
              <ul style="text-align: right; margin: 15px 0; color: rgba(255,255,255,0.9);">
                <li>ğŸš€ Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹</li>
                <li>ğŸ“´ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ±Ù†Øª</li>
                <li>ğŸ”” ØªØ¬Ø±Ø¨Ø© ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠ</li>
                <li>ğŸ’¾ Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
              </ul>
              <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± <strong>Share/Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</strong> ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø«Ù… <strong>"Add to Home Screen"</strong>
              </p>
            </div>
          `;

          this.showModal('ğŸŒŸ Ø«Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù†', content, [
            { text: 'ÙÙ‡Ù…Øª!', primary: true, action: () => this.hideModal() },
            {
              text: 'Ù„Ø§ ØªØ¸Ù‡Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',
              action: () => {
                this.neverShowInstallPrompt = true;
                this.saveData();
                this.hideModal();
              },
            },
          ]);

          this.saveData();
        }

        trackClickTime(time) {
          this.clickTimes.push(time);

          if (this.clickTimes.length > this.minClicksForAuto) {
            this.clickTimes.shift();
          }

          if (
            this.clickTimes.length >= this.minClicksForAuto &&
            !this.autoModeAvailable
          ) {
            this.calculateAverageInterval();
            this.autoModeAvailable = true;
            this.showToast('ğŸ¤– Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©!', 'success');
            this.autoBtn.style.background =
              'linear-gradient(135deg, #51cf66 0%, #40c057 100%)';
          }
        }

        calculateAverageInterval() {
          if (this.clickTimes.length < 2) return;

          let totalInterval = 0;
          for (let i = 1; i < this.clickTimes.length; i++) {
            totalInterval += this.clickTimes[i] - this.clickTimes[i - 1];
          }

          this.averageInterval = totalInterval / (this.clickTimes.length - 1);
          console.log('Average interval calculated:', this.averageInterval);
        }

        toggleAutoMode() {
          if (!this.autoModeAvailable) {
            this.showToast(
              `Ù‚Ù… Ø¨Ø§Ù„Ø²ÙŠØ§Ø¯Ø© ${this.minClicksForAuto} Ù…Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­Ø³Ø§Ø¨ Ø³Ø±Ø¹ØªÙƒ`,
              'error'
            );
            return;
          }

          this.autoMode = !this.autoMode;

          if (this.autoMode) {
            this.startAutoMode();
          } else {
            this.stopAutoMode();
          }
        }

        startAutoMode() {
          this.autoBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
          this.autoBtn.classList.add('active');
          this.autoModeInfo.textContent = `ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙƒÙ„ ${+(
            this.averageInterval / 1000
          ).toFixed(1)}Ø«)`;
          
          this.autoInterval = setInterval(() => {
            this.count++;
            this.updateDisplay();
            this.saveData();
            this.animateCounter();
            this.playFeedback();
            this.checkGoalReached();
          }, this.averageInterval);

          this.showToast('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'success');
        }

        stopAutoMode() {
          if (this.autoInterval) {
            clearInterval(this.autoInterval);
            this.autoInterval = null;
          }

          this.autoBtn.textContent = 'ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
          this.autoBtn.classList.remove('active');
          this.autoModeInfo.textContent = '';

          this.showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'success');
        }

        checkGoalReached() {
          if (this.count > 0 && this.count % this.goal === 0) {
            this.celebrateGoal();

            if (this.inGroupMode && this.currentGroup) {
              this.moveToNextDhikrInGroup();
            }
          }
        }

        celebrateGoal() {
          this.createCelebrationParticles();
          this.playLongVibration();

          const multiple = Math.floor(this.count / this.goal);
          if (multiple === 1) {
            this.showToast('ğŸ‰ Ù…Ø§Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù‡Ø¯Ù! ğŸ‰', 'celebration');
          } else {
            this.showToast(
              `ğŸ‰ Ù…Ù…ØªØ§Ø²! ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù‡Ø¯Ù ${multiple} Ù…Ø±Ø§Øª! ğŸ‰`,
              'celebration'
            );
          }
        }

        moveToNextDhikrInGroup() {
          this.currentGroupIndex++;

          if (this.currentGroupIndex >= this.currentGroup.dhikrs.length) {
            // Group completed
            this.showToast('ğŸŠ ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„! ğŸŠ', 'celebration');
            this.inGroupMode = false;
            this.currentGroup = null;
            this.currentGroupIndex = 0;
            this.goal = 100; // Reset to default

            // Reset auto mode when group is completed
            this.resetAutoMode();
          } else {
            // Move to next dhikr
            const nextDhikr = this.currentGroup.dhikrs[this.currentGroupIndex];
            this.currentDhikr = nextDhikr.text;
            this.goal = nextDhikr.count;
            this.count = 0; // Reset count for new dhikr

            // Reset auto mode when changing dhikr in group
            this.resetAutoMode();

            this.playLongVibration();
            this.showToast(`Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰: ${nextDhikr.text}`, 'success');
          }

          this.updateDisplay();
          this.saveData();
        }

        resetCount() {
          this.showConfirmModal(
            'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯',
            'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ±ØŸ',
            () => {
              this.count = 0;
              this.updateDisplay();
              this.saveData();
              this.animateReset();
              this.showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯', 'success');
            }
          );
        }

        changeGoal() {
          this.showInputModal(
            'ØªØºÙŠÙŠØ± Ø§Ù„Ù‡Ø¯Ù',
            'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:',
            this.goal.toString(),
            'number',
            (value) => {
              const newGoal = parseInt(value);
              if (newGoal && newGoal > 0) {
                this.goal = newGoal;
                this.updateDisplay();
                this.saveData();
                this.showToast(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù‡Ø¯Ù Ø¥Ù„Ù‰ ${newGoal}`, 'success');
              }
            }
          );
        }

        showGroupsModal() {
          const defaultGroups = this.dhikrGroups;
          const customGroups = this.customGroups;

          let content = '<div class="dhikr-list">';

          // Default groups (non-editable)
          if (defaultGroups.length > 0) {
            content +=
              '<p style="color: #4facfe; font-weight: 600; margin: 10px 0;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</p>';
            defaultGroups.forEach((group, index) => {
              content += `
                <div class="group-item" onclick="app.selectGroup(${index})">
                  <div class="group-title">${group.name}</div>
                  <div class="group-desc">
                    ${group.dhikrs
                      .map((d) => `${d.text} (${d.count})`)
                      .join(' â€¢ ')}
                  </div>
                </div>
              `;
            });
          }

          // Custom groups (editable)
          if (customGroups.length > 0) {
            content +=
              '<p style="color: #ffd93d; font-weight: 600; margin: 15px 0 10px 0;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©:</p>';
            customGroups.forEach((group, index) => {
              const groupIndex = defaultGroups.length + index;
              content += `
                <div class="group-item custom-group-item">
                  <div onclick="app.selectGroup(${groupIndex})" style="flex-grow: 1;">
                    <div class="group-title">${group.name}</div>
                    <div class="group-desc">
                      ${group.dhikrs
                        .map((d) => `${d.text} (${d.count})`)
                        .join(' â€¢ ')}
                    </div>
                  </div>
                  <div class="group-actions">
                    <button onclick="event.stopPropagation(); app.editCustomGroup(${index})" class="action-btn edit-btn" title="ØªØ¹Ø¯ÙŠÙ„">
                      âœï¸
                    </button>
                    <button onclick="event.stopPropagation(); app.deleteCustomGroup(${index})" class="action-btn delete-btn" title="Ø­Ø°Ù">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
              `;
            });
          }

          content += `
            <div class="group-item" onclick="app.createCustomGroup()">
              <div class="group-title">â• Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØµØµØ©</div>
              <div class="group-desc">Ø£Ø¶Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø°ÙƒØ§Ø± Ø¨Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ø®ØµØµØ©</div>
            </div>
          `;

          content += '</div>';

          this.showModal('Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±', content);
        }

        selectGroup(index) {
          const allGroups = [...this.dhikrGroups, ...this.customGroups];
          this.currentGroup = allGroups[index];
          this.currentGroupIndex = 0;
          this.inGroupMode = true;

          const firstDhikr = this.currentGroup.dhikrs[0];
          this.currentDhikr = firstDhikr.text;
          this.goal = firstDhikr.count;
          this.count = 0;

          // Reset auto mode when starting a group
          this.resetAutoMode();

          this.hideModal();
          this.updateDisplay();
          this.saveData();

          this.showToast(`Ø¨Ø¯Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©: ${this.currentGroup.name}`, 'success');
        }

        createCustomGroup() {
          this.hideModal();

          this.showInputModal(
            'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØµØµØ©',
            'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:',
            '',
            'text',
            (groupName) => {
              if (groupName.trim()) {
                this.hideModal(); // Hide the input modal first
                this.customGroupBuilder = {
                  name: groupName.trim(),
                  dhikrs: [],
                  editIndex: undefined, // Mark as new creation
                };
                setTimeout(() => {
                  this.showCustomGroupBuilder(groupName.trim());
                }, 100);
              }
            },
            false
          );
        }

        showCustomGroupBuilder(groupName) {
          const dhikrsList = this.customGroupBuilder.dhikrs
            .map(
              (dhikr, index) => `
            <div class="dhikr-item" style="display: flex; justify-content: space-between; align-items: center;">
              <span>${dhikr.text} (${dhikr.count})</span>
              <button onclick="app.removeCustomDhikr(${index})" style="background: #ff6b6b; border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                ğŸ—‘ï¸
              </button>
            </div>
          `
            )
            .join('');

          const content = `
            <div>
              <p>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©: <strong>${groupName}</strong></p>
              <div style="max-height: 200px; overflow-y: auto; margin: 15px 0;">
                ${dhikrsList}
              </div>
              <button class="modal-btn primary" onclick="app.addCustomDhikr()" style="width: 100%; margin: 10px 0;">
                â• Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±
              </button>
            </div>
          `;

          this.showModal('Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØµØµØ©', content, [
            {
              text: 'Ø­ÙØ¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
              primary: true,
              action: () => this.saveCustomGroup(groupName),
            },
            { text: 'Ø¥Ù„ØºØ§Ø¡', action: () => this.hideModal() },
          ]);
        }

        addCustomDhikr() {
          this.showInputModal(
            'Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±',
            'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ:',
            '',
            'text',
            (dhikrText) => {
              if (dhikrText.trim()) {
                this.showInputModal(
                  'Ø¹Ø¯Ø¯ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª',
                  'Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª:',
                  '33',
                  'number',
                  (count) => {
                    const countNum = parseInt(count);
                    if (countNum && countNum > 0) {
                      this.customGroupBuilder.dhikrs.push({
                        text: dhikrText.trim(),
                        count: countNum,
                      });

                      // Go back to appropriate builder
                      setTimeout(() => {
                        if (this.customGroupBuilder.editIndex !== undefined) {
                          // We're editing
                          this.showCustomGroupEditor(
                            this.customGroupBuilder.name,
                            this.customGroupBuilder.editIndex
                          );
                        } else {
                          // We're creating new
                          this.showCustomGroupBuilder(
                            this.customGroupBuilder.name
                          );
                        }
                      }, 100);
                    }
                  },
                  false
                );
              }
            },
            false
          );
        }

        updateCustomGroupDisplay() {
          // Return to the group builder immediately
          this.showCustomGroupBuilder(this.customGroupBuilder.name);
        }

        deleteCustomGroup(index) {
          const group = this.customGroups[index];
          this.showConfirmModal(
            'Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
            `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© "${group.name}"ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`,
            () => {
              // Check if this group is currently active
              if (
                this.inGroupMode &&
                this.currentGroup &&
                this.currentGroup.name === group.name
              ) {
                // Reset to default state if deleting active group
                this.inGroupMode = false;
                this.currentGroup = null;
                this.currentGroupIndex = 0;
                this.currentDhikr = 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡';
                this.goal = 100;
                this.count = 0;
                this.resetAutoMode();
                this.updateDisplay();
              }

              this.customGroups.splice(index, 1);
              this.saveData();
              this.showToast(`ØªÙ… Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø©: ${group.name}`, 'success');

              // Refresh the groups modal
              setTimeout(() => {
                this.showGroupsModal();
              }, 1000);
            }
          );
        }

        editCustomGroup(index) {
          const group = this.customGroups[index];
          this.hideModal();

          // Set up the editor with existing group data
          this.customGroupBuilder = {
            name: group.name,
            dhikrs: [...group.dhikrs], // Copy existing dhikrs
            editIndex: index, // Mark that we're editing
          };

          setTimeout(() => {
            this.showCustomGroupEditor(group.name, index);
          }, 100);
        }

        showCustomGroupEditor(groupName, editIndex) {
          const dhikrsList = this.customGroupBuilder.dhikrs
            .map(
              (dhikr, index) => `
            <div class="dhikr-item" style="display: flex; justify-content: space-between; align-items: center;">
              <span>${dhikr.text} (${dhikr.count})</span>
              <button onclick="app.removeCustomDhikr(${index})" style="background: #ff6b6b; border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                ğŸ—‘ï¸
              </button>
            </div>
          `
            )
            .join('');

          const content = `
            <div>
              <p>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©: <strong>${groupName}</strong></p>
              <button class="modal-btn secondary" onclick="app.editGroupName(${editIndex})" style="width: 100%; margin: 10px 0;">
                âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
              </button>
              <div style="max-height: 200px; overflow-y: auto; margin: 15px 0;">
                ${dhikrsList}
              </div>
              <button class="modal-btn primary" onclick="app.addCustomDhikr()" style="width: 100%; margin: 10px 0;">
                â• Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±
              </button>
            </div>
          `;

          this.showModal('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø®ØµØµØ©', content, [
            {
              text: 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª',
              primary: true,
              action: () => this.saveEditedGroup(editIndex),
            },
            { text: 'Ø¥Ù„ØºØ§Ø¡', action: () => this.hideModal() },
          ]);
        }

        editGroupName(editIndex) {
          const currentName = this.customGroupBuilder.name;
          this.showInputModal(
            'ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
            'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:',
            currentName,
            'text',
            (newName) => {
              if (newName.trim() && newName.trim() !== currentName) {
                this.customGroupBuilder.name = newName.trim();
                this.hideModal();
                setTimeout(() => {
                  this.showCustomGroupEditor(newName.trim(), editIndex);
                }, 100);
              } else {
                this.hideModal();
                setTimeout(() => {
                  this.showCustomGroupEditor(currentName, editIndex);
                }, 100);
              }
            },
            false
          );
        }

        saveEditedGroup(editIndex) {
          if (this.customGroupBuilder.dhikrs.length === 0) {
            this.hideModal();
            setTimeout(() => {
              this.showToast('Ø£Ø¶Ù Ø°ÙƒØ±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
              setTimeout(() => {
                this.showCustomGroupEditor(
                  this.customGroupBuilder.name,
                  editIndex
                );
              }, 3500);
            }, 300);
            return;
          }

          // Check if this group is currently active and update it
          const oldGroup = this.customGroups[editIndex];
          if (
            this.inGroupMode &&
            this.currentGroup &&
            this.currentGroup.name === oldGroup.name
          ) {
            // Update current group reference
            this.currentGroup = {
              name: this.customGroupBuilder.name,
              dhikrs: [...this.customGroupBuilder.dhikrs],
            };
          }

          // Update the group
          this.customGroups[editIndex] = {
            name: this.customGroupBuilder.name,
            dhikrs: [...this.customGroupBuilder.dhikrs],
          };

          this.hideModal();
          this.saveData();
          this.updateDisplay(); // Update display in case active group was modified
          this.showToast(
            `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©: ${this.customGroupBuilder.name}`,
            'success'
          );

          // Show groups modal after successful edit
          setTimeout(() => {
            this.showGroupsModal();
          }, 1000);
        }

        saveCustomGroup(groupName) {
          if (this.customGroupBuilder.dhikrs.length === 0) {
            // Hide modal first, then show toast with delay to ensure it's visible
            this.hideModal();
            setTimeout(() => {
              this.showToast('Ø£Ø¶Ù Ø°ÙƒØ±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
              // Show the group builder again after error toast
              setTimeout(() => {
                this.showCustomGroupBuilder(groupName);
              }, 3500);
            }, 300);
            return;
          }

          this.customGroups.push({
            name: groupName,
            dhikrs: [...this.customGroupBuilder.dhikrs],
          });

          this.hideModal();
          this.saveData();
          this.showToast(`ØªÙ… Ø­ÙØ¸ Ù…Ø¬Ù…ÙˆØ¹Ø©: ${groupName}`, 'success');

          // Show groups modal after successful creation
          setTimeout(() => {
            this.showGroupsModal();
          }, 1000);
        }

        showMenuModal() {
          let content = '<div class="dhikr-list">';

          content += `
            <div class="dhikr-item" onclick="app.showDhikrSelection()">
              <strong>ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø­Ø§Ù„ÙŠ</strong>
            </div>
            <div class="dhikr-item" onclick="app.showSettings()">
              <strong>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</strong>
            </div>
            <div class="dhikr-item" onclick="app.showStats()">
              <strong>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</strong>
            </div>
          `;

          content += '</div>';

          this.showModal('Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', content);
        }

        showDhikrSelection() {
          let content = '<div class="dhikr-list">';

          this.dhikrOptions.forEach((dhikr, index) => {
            const isSelected = dhikr === this.currentDhikr;
            content += `
              <div class="dhikr-item ${
                isSelected ? 'selected' : ''
              }" onclick="app.selectDhikr(${index})" style="${
              isSelected
                ? 'background: rgba(79, 172, 254, 0.3); border-color: #4facfe;'
                : ''
            }">
                ${dhikr} ${isSelected ? 'âœ“' : ''}
              </div>
            `;
          });

          content += `
            <div class="dhikr-item" onclick="app.addCustomDhikrSingle()">
              <strong>â• Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù…Ø®ØµØµ</strong>
            </div>
          `;

          content += '</div>';

          this.showModal('Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒØ±', content);
        }

        selectDhikr(index) {
          this.currentDhikr = this.dhikrOptions[index];

          // Reset auto mode when changing dhikr
          this.resetAutoMode();

          this.hideModal();
          this.updateDisplay();
          this.saveData();
          this.showToast(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ± Ø¥Ù„Ù‰: ${this.currentDhikr}`, 'success');
        }

        resetAutoMode() {
          // Stop auto mode if running
          if (this.autoMode) {
            this.stopAutoMode();
          }

          // Reset auto mode properties
          this.autoMode = false;
          this.autoModeAvailable = false;
          this.clickTimes = [];
          this.averageInterval = 0;

          // Update button appearance
          this.autoBtn.textContent = 'ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
          this.autoBtn.classList.remove('active');
          this.autoBtn.style.background =
            'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)';
          this.autoModeInfo.textContent = '';

          this.showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'success');
        }

        addCustomDhikrSingle() {
          this.hideModal();

          this.showInputModal(
            'Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ± Ù…Ø®ØµØµ',
            'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯:',
            '',
            'text',
            (dhikrText) => {
              if (dhikrText.trim()) {
                this.dhikrOptions.push(dhikrText.trim());
                this.currentDhikr = dhikrText.trim();

                // Reset auto mode when adding custom dhikr
                this.resetAutoMode();

                this.updateDisplay();
                this.saveData();
                this.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ù…Ø®ØµØµ', 'success');
              }
            }
          );
        }

        showSettings() {
          const content = `
            <div>
              <div class="modal-content">
                <p><strong>Ø²Ù…Ù† Ù…Ù†Ø¹ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:</strong></p>
                <input type="range" min="0" max="3000" step="100" value="${
                  this.clickDebounceTime
                }" 
                       onchange="app.updateDebounceTime(this.value)" 
                       style="width: 100%; margin: 10px 0;">
                <p style="text-align: center;">${
                  this.clickDebounceTime === 0
                    ? 'Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯'
                    : this.clickDebounceTime / 1000 + ' Ø«Ø§Ù†ÙŠØ©'
                }</p>
                
                <p><strong>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø²ÙŠØ§Ø¯Ø§Øª Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</strong></p>
                <input type="range" min="5" max="20" step="1" value="${
                  this.minClicksForAuto
                }" 
                       onchange="app.updateMinClicks(this.value)" 
                       style="width: 100%; margin: 10px 0;">
                <p style="text-align: center;">${
                  this.minClicksForAuto
                } Ø²ÙŠØ§Ø¯Ø§Øª</p>
              </div>
            </div>
          `;

          this.showModal('Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', content);
        }

        updateDebounceTime(value) {
          this.clickDebounceTime = parseInt(value);
          this.saveData();
        }

        updateMinClicks(value) {
          this.minClicksForAuto = parseInt(value);
          this.saveData();
        }

        showStats() {
          const totalSessions =
            this.count > 0 ? Math.ceil(this.count / this.goal) : 0;
          const autoStatus = this.autoModeAvailable ? 'Ù…ØªØ§Ø­' : 'ØºÙŠØ± Ù…ØªØ§Ø­';

          const content = `
            <div class="modal-content">
              <p><strong>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${this.count}</p>
              <p><strong>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${this.goal}</p>
              <p><strong>Ø§Ù„ØªÙ‚Ø¯Ù…:</strong> ${Math.round(
                (this.count / this.goal) * 100
              )}%</p>
              <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</strong> ${Math.floor(
                this.count / this.goal
              )}</p>
              <p><strong>Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${this.currentDhikr}</p>
              <p><strong>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©:</strong> ${autoStatus}</p>
              ${
                this.autoModeAvailable
                  ? `<p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø±Ø¹Ø©:</strong> ${Math.round(
                      this.averageInterval / 1000
                    )} Ø«Ø§Ù†ÙŠØ©</p>`
                  : ''
              }
              <p><strong>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${
                this.inGroupMode ? this.currentGroup.name : 'ØºÙŠØ± Ù…ÙØ¹Ù„'
              }</p>
            </div>
          `;

          this.showModal('Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', content);
        }

        showHelpModal() {
          const content = `
            <div class="modal-content">
              <p><strong>ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong></p>
              <p>ğŸ–±ï¸ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ø²ÙŠØ§Ø¯Ø©</p>
              <p>ğŸ”„ Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</p>
              <p>ğŸ¯ Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù Ù„ØªØºÙŠÙŠØ±Ù‡</p>
              <p>â¸ï¸ Ø§Ù†Ù‚Ø± Ù…Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ø¥ÙŠÙ‚Ø§Ù/ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ±</p>
              <p>ğŸ“ Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ±</p>
              <p>ğŸ¤– Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ØªØªÙØ¹Ù„ Ø¨Ø¹Ø¯ 10 Ø²ÙŠØ§Ø¯Ø§Øª</p>
              <p>ğŸ“± Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù ÙˆÙ…Ø¶Ø§Ø¹ÙØ§ØªÙ‡</p>
              <p>ğŸ“š Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù„Ù„ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù…Ù†Ø¸Ù…</p>
            </div>
          `;

          this.showModal('Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©', content);
        }

        showModal(title, content, buttons = null) {
          this.modalTitle.textContent = title;
          this.modalContent.innerHTML = content;

          this.modalButtons.innerHTML = '';

          if (buttons) {
            buttons.forEach((btn) => {
              const button = document.createElement('button');
              button.className = `modal-btn ${
                btn.primary ? 'primary' : 'secondary'
              }`;
              button.textContent = btn.text;
              button.onclick = btn.action;
              this.modalButtons.appendChild(button);
            });
          } else {
            const closeBtn = document.createElement('button');
            closeBtn.className = 'modal-btn primary';
            closeBtn.textContent = 'Ø­Ø³Ù†Ø§Ù‹';
            closeBtn.onclick = () => this.hideModal();
            this.modalButtons.appendChild(closeBtn);
          }

          this.modalOverlay.classList.add('show');
        }

        showInputModal(
          title,
          message,
          defaultValue,
          type,
          callback,
          autoHide = true
        ) {
          const content = `
            <p>${message}</p>
            <input type="${type}" class="modal-input" id="modalInput" value="${defaultValue}" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©...">
          `;

          this.showModal(title, content, [
            {
              text: 'Ù…ÙˆØ§ÙÙ‚',
              primary: true,
              action: () => {
                const input = document.getElementById('modalInput');
                if (input && input.value.trim()) {
                  callback(input.value.trim());
                  if (autoHide) {
                    this.hideModal();
                  }
                }
              },
            },
            { text: 'Ø¥Ù„ØºØ§Ø¡', action: () => this.hideModal() },
          ]);

          setTimeout(() => {
            const input = document.getElementById('modalInput');
            if (input) {
              input.focus();
              input.select();
            }
          }, 100);
        }

        showConfirmModal(title, message, callback) {
          this.showModal(title, `<p>${message}</p>`, [
            {
              text: 'Ù†Ø¹Ù…',
              primary: true,
              action: () => {
                callback();
                this.hideModal();
              },
            },
            { text: 'Ø¥Ù„ØºØ§Ø¡', action: () => this.hideModal() },
          ]);
        }

        hideModal() {
          this.modalOverlay.classList.remove('show');
        }

        showToast(message, type = 'default') {
          this.toast.textContent = message;
          this.toast.className = `toast ${type}`;
          this.toast.classList.add('show');
          this.toast.classList.remove('hide');

          setTimeout(() => {
            this.toast.classList.remove('show');
            this.toast.classList.add('hide');
          }, 3000);
        }

        updateDisplay() {
          this.counterNumber.textContent = this.count;
          this.goalInfo.textContent = `Ø§Ù„Ù‡Ø¯Ù: ${this.goal}`;
          this.titleText.textContent = this.currentDhikr;

          // Check if title needs scrolling
          const titleWidth = this.titleText.offsetWidth;
          const containerWidth = this.appTitle.offsetWidth - 32; // Account for padding

          if (titleWidth > containerWidth) {
            this.titleText.classList.remove('short');
          } else {
            this.titleText.classList.add('short');
          }

          const progress = Math.min((this.count / this.goal) * 100, 100);
          this.progressFill.style.width = `${progress}%`;

          // Update group info if in group mode
          if (this.inGroupMode && this.currentGroup) {
            const groupProgress = `(${this.currentGroupIndex + 1}/${
              this.currentGroup.dhikrs.length
            })`;
            this.goalInfo.textContent += ` ${groupProgress}`;
          }
          // Initialize Lucide icons
          setTimeout(() => {
            if (typeof lucide !== 'undefined') {
              lucide.createIcons();
            }
          }, 100);
        }

        animateCounter() {
          this.counterContainer.classList.add('pulse');
          setTimeout(() => {
            this.counterContainer.classList.remove('pulse');
          }, 300);
        }

        animateReset() {
          this.counterContainer.style.transform = 'rotateY(180deg)';
          setTimeout(() => {
            this.counterContainer.style.transform = 'rotateY(0deg)';
          }, 300);
        }

        playFeedback() {
          if (navigator.vibrate) {
            navigator.vibrate(50);
          }
        }

        playLongVibration() {
          if (navigator.vibrate) {
            navigator.vibrate([200, 100, 200]);
          }
        }

        createParticles() {
          const particlesContainer = document.getElementById('particles');

          setInterval(() => {
            if (Math.random() > 0.7) {
              const particle = document.createElement('div');
              particle.className = 'particle';
              particle.style.left = Math.random() * 100 + '%';
              particle.style.animationDuration = Math.random() * 4 + 4 + 's';
              particlesContainer.appendChild(particle);

              setTimeout(() => {
                particle.remove();
              }, 8000);
            }
          }, 1000);
        }

        createCelebrationParticles() {
          const particlesContainer = document.getElementById('particles');

          for (let i = 0; i < 20; i++) {
            setTimeout(() => {
              const particle = document.createElement('div');
              particle.className = 'particle';
              particle.style.left = Math.random() * 100 + '%';
              particle.style.background = `hsl(${
                Math.random() * 360
              }, 70%, 60%)`;
              particle.style.width = '6px';
              particle.style.height = '6px';
              particle.style.animationDuration = '3s';
              particlesContainer.appendChild(particle);

              setTimeout(() => {
                particle.remove();
              }, 3000);
            }, i * 100);
          }
        }

        saveData() {
          const data = {
            count: this.count,
            goal: this.goal,
            currentDhikr: this.currentDhikr,
            clickDebounceTime: this.clickDebounceTime,
            minClicksForAuto: this.minClicksForAuto,
            autoModeAvailable: this.autoModeAvailable,
            averageInterval: this.averageInterval,
            customGroups: this.customGroups,
            currentGroup: this.currentGroup,
            currentGroupIndex: this.currentGroupIndex,
            inGroupMode: this.inGroupMode,
            dhikrOptions: this.dhikrOptions,
            installPromptShown: this.installPromptShown,
            neverShowInstallPrompt: this.neverShowInstallPrompt || false,
          };

          try {
            localStorage.setItem('advancedTasbihData', JSON.stringify(data));
          } catch (e) {
            console.log('localStorage not available');
          }
        }

        loadData() {
          try {
            const saved = localStorage.getItem('advancedTasbihData');
            if (saved) {
              const data = JSON.parse(saved);
              this.count = data.count || 0;
              this.goal = data.goal || 100;
              this.currentDhikr = data.currentDhikr || 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡';
              this.clickDebounceTime = data.clickDebounceTime || 1000;
              this.minClicksForAuto = data.minClicksForAuto || 10;
              this.autoModeAvailable = data.autoModeAvailable || false;
              this.averageInterval = data.averageInterval || 0;
              this.customGroups = data.customGroups || [];
              this.currentGroup = data.currentGroup || null;
              this.currentGroupIndex = data.currentGroupIndex || 0;
              this.inGroupMode = data.inGroupMode || false;
              this.dhikrOptions = data.dhikrOptions || this.dhikrOptions;
              this.installPromptShown = data.installPromptShown || false;
              this.neverShowInstallPrompt =
                data.neverShowInstallPrompt || false;
            }
          } catch (e) {
            console.log('Could not load data from localStorage');
          }
        }

        resetAutoInterval() {
          if (!this.autoModeAvailable) {
            this.showToast('Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹', 'error');
            return;
          }

          this.showInputModal(
            'Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©',
            'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ (Ù…Ø«Ø§Ù„: 2):',
            Math.round(this.averageInterval / 1000).toString(),
            'number',
            (value) => {
              const newInterval = parseFloat(value) * 1000;
              if (newInterval && newInterval >= 500 && newInterval <= 10000) {
                this.averageInterval = newInterval;

                // If auto mode is currently running, restart it with new interval
                if (this.autoMode) {
                  this.stopAutoMode();
                  setTimeout(() => this.startAutoMode(), 100);
                }

                this.saveData();
                this.showToast(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¯Ø© Ø¥Ù„Ù‰ ${value} Ø«Ø§Ù†ÙŠØ©`, 'success');
              } else {
                this.showToast('Ø£Ø¯Ø®Ù„ Ù…Ø¯Ø© Ø¨ÙŠÙ† 0.5 Ùˆ 10 Ø«ÙˆØ§Ù†ÙŠ', 'error');
              }
            }
          );
        }
      }

      // Global app instance
      let app;

      document.addEventListener('DOMContentLoaded', () => {
        app = new AdvancedTasbihApp();
      });
      // Register service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('./sw.js')
            .then((registration) => console.log('SW registered'))
            .catch((registrationError) =>
              console.log('SW registration failed')
            );
        });
      }
    </script>
  </body>
</html>
